<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resultado ‚Äì {{ materia }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --primary: #6C63FF;
      --accent: #FF6584;
      --success: #43D9AD;
      --error: #FF6584;
      --bg: #0F0E17;
      --surface: #1C1B2E;
      --surface2: #252340;
      --text: #FFFFFE;
      --muted: #A7A9BE;
      --radius: 16px;
    }

    body {
      font-family: 'Nunito', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 20px 16px 60px;
    }

    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      max-width: 700px;
      margin: 0 auto 28px;
    }

    .back-btn {
      background: var(--surface);
      border: 1px solid var(--surface2);
      color: var(--muted);
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 0.9rem;
      font-family: inherit;
      font-weight: 700;
      cursor: pointer;
      text-decoration: none;
      white-space: nowrap;
      transition: background 0.2s, color 0.2s;
    }

    .back-btn:hover {
      background: var(--surface2);
      color: var(--text);
    }

    /* Score hero */
    .score-hero {
      max-width: 700px;
      margin: 0 auto 32px;
      background: var(--surface);
      border-radius: 24px;
      padding: 36px 24px;
      text-align: center;
      border: 1px solid var(--surface2);
      position: relative;
      overflow: hidden;
    }

    .score-hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at 50% 0%, rgba(108, 99, 255, 0.15) 0%, transparent 70%);
      pointer-events: none;
    }

    .score-emoji {
      font-size: 64px;
      display: block;
      margin-bottom: 12px;
      animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
    }

    @keyframes pop {
      from {
        transform: scale(0);
        opacity: 0;
      }

      to {
        transform: scale(1);
        opacity: 1;
      }
    }

    .score-label {
      font-size: 0.8rem;
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .score-value {
      font-size: clamp(3.5rem, 15vw, 5.5rem);
      font-weight: 900;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      line-height: 1;
      margin-bottom: 6px;
      animation: pop 0.6s 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
    }

    .score-max {
      font-size: 1rem;
      color: var(--muted);
      font-weight: 700;
    }

    .stats-row {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-top: 24px;
      flex-wrap: wrap;
    }

    .stat {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .stat-num {
      font-size: 1.6rem;
      font-weight: 900;
    }

    .stat-lbl {
      font-size: 0.75rem;
      font-weight: 700;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.07em;
    }

    .stat-num.ok {
      color: var(--success);
    }

    .stat-num.err {
      color: var(--error);
    }

    /* Progress bar */
    .progress-wrap {
      max-width: 700px;
      margin: 0 auto 32px;
    }

    .progress-bar-bg {
      background: var(--surface2);
      border-radius: 99px;
      height: 14px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      border-radius: 99px;
      background: linear-gradient(90deg, var(--primary), var(--accent));
      transition: width 1s ease;
    }

    /* Review section */
    .section-title {
      max-width: 700px;
      margin: 0 auto 16px;
      font-size: 1rem;
      font-weight: 800;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .review-cards {
      max-width: 700px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .review-card {
      background: var(--surface);
      border-radius: var(--radius);
      padding: 20px 18px;
      border-left: 4px solid;
    }

    .review-card.correct {
      border-color: var(--success);
    }

    .review-card.wrong {
      border-color: var(--error);
    }

    .review-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .review-badge {
      font-size: 1.1rem;
    }

    .review-enunciado {
      font-size: 0.95rem;
      font-weight: 700;
      line-height: 1.4;
      flex: 1;
    }

    .review-detail {
      font-size: 0.82rem;
      color: var(--muted);
      margin-top: 4px;
    }

    .review-detail span.correct-ans {
      color: var(--success);
      font-weight: 800;
    }

    .review-detail span.wrong-ans {
      color: var(--error);
      font-weight: 800;
    }

    /* Retry */
    .retry-wrap {
      max-width: 700px;
      margin: 28px auto 0;
    }

    .btn-retry {
      display: block;
      width: 100%;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      border: none;
      border-radius: var(--radius);
      padding: 18px;
      font-size: 1.05rem;
      font-weight: 900;
      font-family: inherit;
      cursor: pointer;
      text-align: center;
      text-decoration: none;
      letter-spacing: 0.02em;
      box-shadow: 0 6px 20px rgba(108, 99, 255, 0.3);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .btn-retry:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 28px rgba(108, 99, 255, 0.45);
    }
  </style>
</head>

<body>
  <div class="header">
    <a href="{{ url_for('index') }}" class="back-btn">‚Üê Inicio</a>
    <span style="font-size:1.2rem;font-weight:900;">üìä Resultado: {{ materia }}</span>
  </div>

  {% set pct = (correctas / total * 100) | round | int %}
  {% if calificacion >= 4.5 %}
  {% set emoji = "üèÜ" %}
  {% set mensaje = "¬°Excelente! ¬°Eres incre√≠ble!" %}
  {% elif calificacion >= 3.5 %}
  {% set emoji = "üåü" %}
  {% set mensaje = "¬°Muy bien hecho!" %}
  {% elif calificacion >= 2.5 %}
  {% set emoji = "üëç" %}
  {% set mensaje = "¬°Buen esfuerzo, sigue as√≠!" %}
  {% elif calificacion >= 1.5 %}
  {% set emoji = "üìö" %}
  {% set mensaje = "Necesitas estudiar un poco m√°s" %}
  {% else %}
  {% set emoji = "üí™" %}
  {% set mensaje = "¬°No te rindas, puedes mejorar!" %}
  {% endif %}

  <div class="score-hero">
    <span class="score-emoji">{{ emoji }}</span>
    <div class="score-label">Tu calificaci√≥n</div>
    <div class="score-value">{{ calificacion }}</div>
    <div class="score-max">de 5 puntos &nbsp;¬∑&nbsp; {{ mensaje }}</div>
    <div class="stats-row">
      <div class="stat">
        <span class="stat-num ok">{{ correctas }}</span>
        <span class="stat-lbl">Correctas</span>
      </div>
      <div class="stat">
        <span class="stat-num err">{{ total - correctas }}</span>
        <span class="stat-lbl">Incorrectas</span>
      </div>
      <div class="stat">
        <span class="stat-num" style="color:var(--primary)">{{ total }}</span>
        <span class="stat-lbl">Total</span>
      </div>
    </div>
  </div>

  <div class="progress-wrap">
    <div class="progress-bar-bg">
      <div class="progress-bar-fill" id="prog" style="width: 0%"></div>
    </div>
  </div>

  <div class="section-title">Revisi√≥n</div>

  <div class="review-cards">
    {% for i, r in enumerate(resultados) %}
    <div class="review-card {{ 'correct' if r.es_correcta else 'wrong' }}">
      <div class="review-header">
        <span class="review-badge">{{ '‚úÖ' if r.es_correcta else '‚ùå' }}</span>
        <span class="review-enunciado">{{ i + 1 }}. {{ r.enunciado }}</span>
      </div>
      {% if not r.es_correcta %}
      <div class="review-detail">
        Tu respuesta: <span class="wrong-ans">{{ r.respuesta_usuario | upper if r.respuesta_usuario else '‚Äî' }}</span>
        &nbsp;¬∑&nbsp;
        Correcta: <span class="correct-ans">{{ r.respuesta_correcta | upper }}</span>
        {% if r.opciones and r.respuesta_correcta in r.opciones %}
        ‚Äî {{ r.opciones[r.respuesta_correcta] }}
        {% endif %}
      </div>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  <div class="retry-wrap">
    <a href="{{ url_for('index') }}" class="btn-retry">üîÑ Volver al inicio</a>
  </div>

  <script>
    setTimeout(() => {
      document.getElementById('prog').style.width = '{{ pct }}%';
    }, 300);
  </script>
</body>

</html>